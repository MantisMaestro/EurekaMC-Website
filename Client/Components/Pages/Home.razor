@page "/"

@inject IDataService DataService

<MudGrid Class="d-flex">
    <MudItem Class="flex-fill" lg="3" xs="12">
        <DiscordCard/>
    </MudItem>
    <MudItem Class="flex-fill" lg="6" xs="12">
        <PlayNowCard OnlineNow="_onlineToday"/>
    </MudItem>
    <MudItem Class="flex-fill" lg="3" xs="12">
        <PatreonCard/>
    </MudItem>
    <MudItem xs="12">
        <MudCarousel TData="object" Class="mud-width-full" Style="height: clamp(200px, 40vw, 640px); border-radius: 5px;" ShowArrows="true"
                     AutoCycle="true" AutoCycleTime="TimeSpan.FromSeconds(5)">
            @foreach (var image in _carouselImages)
            {
                <MudCarouselItem Transition="Transition">
                    <MudPaper>
                        <MudImage Class="responsive-carousel-image" ObjectFit="ObjectFit.Cover"
                                  Src="@image"></MudImage>
                    </MudPaper>
                </MudCarouselItem>
            }
        </MudCarousel>
    </MudItem>
</MudGrid>

@code {
    private const Transition Transition = MudBlazor.Transition.Fade;

    private List<Player> _onlinePlayers = [];
    private List<string> _carouselImages = [];
    private int _onlineToday;

    protected override async Task OnInitializedAsync()
    {
        _onlinePlayers = await DataService.GetOnlinePlayers();
        _onlinePlayers = _onlinePlayers.OrderByDescending(x => x.Name).ToList();
        _onlineToday = await DataService.GetTodayPlayerCount();
        _carouselImages = Directory.GetFiles("wwwroot/images/carousel", "*.*")
            .Where(file => new[] { ".jpg", ".jpeg", ".png", ".gif" }.Contains(Path.GetExtension(file).ToLower()))
            .Select(file => $"images/carousel/{Path.GetFileName(file)}")
            .ToList();
    }

}